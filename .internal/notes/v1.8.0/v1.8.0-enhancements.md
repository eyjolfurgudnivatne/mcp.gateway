# üöÄ MCP Gateway v1.8.0 - Enhancement Roadmap

**Created:** 19. desember 2025  
**Branch:** feat/v1.8.0-enhancements  
**Target:** Future enhancements beyond MCP 2025-11-25 compliance  
**Current Version:** v1.7.3 (published to NuGet)  
**Target Version:** v1.8.0  
**Status:** üöß **IN PROGRESS** (Phase 1-2 complete, Phase 3-4 remaining)  
**Timeline:** No rush - quality over speed  
**Philosophy:** Small, focused releases with high value

---

## üìä Executive Summary

With **v1.7.0 achieving 100% MCP 2025-11-25 compliance**, v1.8.0 focuses on:
- üîç **Quality of life improvements**
- üöÄ **Performance optimizations**
- üìö **Enhanced developer experience**
- üéØ **Optional MCP 2025-11-25 extensions**

**Philosophy:** No rush - focus on stability, community feedback, and incremental value.

**KISS Principle (Keep It Simple, Stupid):**
- Prefer simple, minimal implementations over complex, "complete" ones
- Avoid premature optimization and over-engineering
- Start with spec-compliant MVP, extend based on real needs
- Examples from previous releases:
  - **Icons (v1.6.5):** String input auto-wrapped to array, client infers mime/size
  - **Structured Content (v1.6.5):** Auto-detect format, no validation, zero breaking changes
  - **Output Schema (v1.6.5):** Optional pass-through, no validation enforcement
- When in doubt: **ship the simple version first, iterate based on feedback**

---

## üé® Design Principles (v1.8.0)

Following the success of KISS approach in v1.6.5 and v1.7.0, these principles guide v1.8.0 development:

### 1. KISS (Keep It Simple, Stupid)
**What it means:**
- Start with minimal viable implementation
- Avoid premature abstraction and generalization
- Defer complexity until proven necessary

**When to apply:**
- ‚úÖ Implementing new MCP features (start spec-compliant, extend later)
- ‚úÖ Designing APIs (simple string inputs over complex objects)
- ‚úÖ Error handling (clear messages over verbose stack traces)

**Examples:**
```csharp
// GOOD: Simple string input
[McpTool("calc", Icon = "https://example.com/icon.png")]

// AVOID: Complex object prematurely
[McpTool("calc", Icon = new IconDefinition { 
    Src = "...", 
    MimeType = "...", 
    Sizes = new[] { "48x48" } 
})]
```

### 2. Zero Breaking Changes
**What it means:**
- All v1.x.0 releases must be backward compatible
- Deprecate before removal (grace period: 1-2 major versions)
- New features are additive, not replacements

**When to apply:**
- ‚úÖ Adding new endpoints (keep old ones, mark deprecated)
- ‚úÖ Extending existing APIs (optional parameters)
- ‚úÖ Changing wire format (support both old and new)

**Examples:**
```csharp
// v1.7.0: Added /mcp, kept /rpc /sse /ws (deprecated but functional)
app.MapStreamableHttpEndpoint("/mcp");  // NEW
app.MapHttpRpcEndpoint("/rpc");         // DEPRECATED but still works
```

### 3. Defer Until Proven
**What it means:**
- Don't implement features "just in case"
- Wait for real user requests before adding complexity
- Validate assumptions with community feedback

**When to apply:**
- ‚úÖ Performance optimizations (measure first!)
- ‚úÖ Advanced features (wildcards, regex, etc.)
- ‚úÖ Custom extensibility points

**Examples:**
- Resource subscription wildcards ‚Üí v1.9.0 (if needed)
- Parameter parsing cache ‚Üí only if bottleneck confirmed
- Hybrid Tool API ‚Üí NOT NEEDED (TypedJsonRpc.Inner exists!)

### 4. Fail Fast, Fail Clear
**What it means:**
- Validate early, error clearly
- Provide actionable error messages
- Don't let bad data propagate

**When to apply:**
- ‚úÖ Tool name validation (MCP regex)
- ‚úÖ Session validation (404 with re-init guidance)
- ‚úÖ Protocol version checks (400 with supported versions)

**Examples:**
```csharp
// GOOD: Clear, actionable error
return Results.Json(new {
    error = new {
        code = -32001,
        message = "Session expired. Please re-initialize with POST /mcp",
        data = new { sessionId, timeoutMinutes = 30 }
    }
}, statusCode: 404);

// AVOID: Generic error
throw new Exception("Invalid session");
```

### 5. Test the Happy Path, Document the Edge Cases
**What it means:**
- Focus tests on common use cases
- Document known limitations clearly
- Don't over-test theoretical scenarios

**When to apply:**
- ‚úÖ Writing integration tests (test real workflows)
- ‚úÖ Documenting features (show examples, list limitations)
- ‚úÖ Code reviews (validate happy path first)

**Examples:**
```csharp
// Test the 99% case
[Fact]
public async Task SubscribeToResource_ExactUri_Works() {}

// Document the 1% case
// Note: Wildcards not supported in v1.8.0 (exact match only)
```

---

## üéØ Potential Enhancements (Not Prioritized)

### Category 1: MCP Protocol Extensions (Optional)

These are **optional** MCP 2025-11-25 features, not required for compliance:

#### 1.1 Resource Subscriptions
**MCP Spec:** Optional `resources/subscribe` and `resources/unsubscribe` methods

```csharp
// Client subscribes to resource changes (exact URI only per MCP spec)
{
  "jsonrpc": "2.0",
  "method": "resources/subscribe",
  "params": {
    "uri": "file://logs/app.log"  // Exact match only in v1.8.0
  },
  "id": 1
}

// Server sends notification when resource changes
{
  "jsonrpc": "2.0",
  "method": "notifications/resources/updated",
  "params": {
    "uri": "file://logs/app.log"
  }
}
```

**Benefits:**
- Clients can subscribe to specific resources instead of receiving all notifications
- Reduces unnecessary notifications
- Better for high-frequency resource updates

**Implementation approach (v1.8.0):**
- Start with exact URI matching only (per MCP 2025-11-25 spec)
- No wildcard support in initial version
- Simpler implementation, clearer semantics
- Can add wildcards as extension in v1.9.0 if needed

**Potential v1.9.0 extensions (based on community feedback):**
- Wildcard patterns: `file://logs/*.log`, `file://logs/**`
- Regex matching: `file://logs/app-[0-9]+.log`
- Prefix matching: `file://logs/` (all resources under path)

**Estimated effort:** 8-12 hours (implement + test, exact matching only)

---

#### 1.2 Resource Templates
**MCP Spec:** URI templates with variables (e.g., `file://logs/{date}.log`)

```csharp
[McpResource("file://logs/{date}.log",
    Name = "Daily Log Files",
    Description = "Log files by date (format: YYYY-MM-DD)")]
public JsonRpcMessage GetLogFile(JsonRpcMessage request)
{
    var uri = request.GetParams().GetProperty("uri").GetString();
    var date = ExtractDateFromUri(uri); // Parse {date} variable
    
    var content = ReadLogFile(date);
    return ToolResponse.Success(request.Id, new ResourceContent(
        Uri: uri,
        MimeType: "text/plain",
        Text: content
    ));
}
```

**Benefits:**
- Dynamic resource generation
- Less boilerplate for parameterized resources
- Better for large resource sets

**Estimated effort:** 12-16 hours (design + implement + test)

---

#### 1.3 Completion API
**MCP Spec:** Optional `completion/complete` method for auto-completion

```csharp
// Client requests completions
{
  "jsonrpc": "2.0",
  "method": "completion/complete",
  "params": {
    "ref": {
      "type": "ref/prompt",
      "name": "summarize"
    },
    "argument": {
      "name": "topic",
      "value": "mach"
    }
  },
  "id": 1
}

// Server returns completions
{
  "jsonrpc": "2.0",
  "result": {
    "completion": {
      "values": ["machine learning", "machine vision", "Mach number"],
      "total": 3,
      "hasMore": false
    }
  },
  "id": 1
}
```

**Benefits:**
- Better UX for prompts with many arguments
- IDE-like auto-completion in MCP clients
- Type-ahead search for resources

**Estimated effort:** 16-20 hours (design + implement + test)

---

#### 1.4 Logging Support
**MCP Spec:** Optional client-to-server log forwarding

```csharp
// Client sets log level
{
  "jsonrpc": "2.0",
  "method": "logging/setLevel",
  "params": {
    "level": "debug"
  }
}

// Server sends log messages
{
  "jsonrpc": "2.0",
  "method": "notifications/message",
  "params": {
    "level": "info",
    "logger": "ToolInvoker",
    "data": "Tool 'add_numbers' executed successfully"
  }
}
```

**Benefits:**
- Unified logging across client-server boundary
- Better debugging for MCP integrations
- Centralized log collection

**Estimated effort:** 12-16 hours (design + implement + test)

---

### Category 2: Performance Optimizations

#### 2.1 Parameter Parsing Cache
**Goal:** Cache parsed tool parameters to avoid repeated JSON deserialization

**Current:**
```csharp
// Every tool call parses params from scratch
var args = request.GetParams<AddNumbersRequest>();
```

**Proposed:**
```csharp
// Cache parsed params per request ID
var args = request.GetCachedParams<AddNumbersRequest>();
```

**Benefits:**
- Faster tool invocation (especially for streaming tools)
- Less GC pressure
- Better for high-throughput scenarios

**Trade-offs:**
- Added complexity
- Memory overhead for caching
- May not provide significant benefit for simple tools

**Estimated effort:** 8-12 hours (implement + benchmark + test)  
**Priority:** LOW (optimize only if bottleneck confirmed)

---

#### 2.2 Connection Pooling
**Goal:** Reuse HTTP/WebSocket connections for repeated tool calls

**Benefits:**
- Reduced connection overhead
- Better for client libraries making many requests
- Lower latency for subsequent calls

**Trade-offs:**
- Already handled by HttpClient in most cases
- May not provide significant benefit

**Estimated effort:** 12-16 hours (design + implement + test)  
**Priority:** LOW (measure first)

---

#### 2.3 Streaming Optimizations
**Goal:** Reduce allocations and improve throughput for binary/text streaming

**Ideas:**
- Use `Span<T>` and `Memory<T>` for zero-copy operations
- Pipeline-based streaming (System.IO.Pipelines)
- Chunked encoding optimizations

**Benefits:**
- Lower memory usage
- Higher throughput for large files
- Better for media streaming scenarios

**Estimated effort:** 20-30 hours (design + implement + benchmark + test)  
**Priority:** MEDIUM (if streaming becomes a bottleneck)

---

### Category 3: Developer Experience

#### 3.1 TypedJsonRpc<T> Already Has Raw JSON Access! ‚úÖ

**Note:** `TypedJsonRpc<T>` already provides access to raw `JsonRpcMessage` via the `.Inner` property:

```csharp
[McpTool("add_numbers")]
public JsonRpcMessage AddNumbers(
    TypedJsonRpc<AddNumbersRequest> request,
    ILogger<CalculatorTools> logger)
{
    // Typed access
    var args = request.GetParams();
    
    // Raw JSON access via Inner property!
    logger.LogInformation("Raw JSON: {Raw}", request.Inner.ToJson());
    logger.LogInformation("Method: {Method}", request.Inner.Method);
    logger.LogInformation("ID: {Id}", request.Inner.Id);
    
    return ToolResponse.Success(request.Id, new { result = args.Number1 + args.Number2 });
}
```

**Conclusion:** No need for a separate Hybrid Tool API - `TypedJsonRpc<T>` already provides the best of both worlds!

**Status:** ‚úÖ **NOT NEEDED** (already implemented in v1.3.0)

---

#### 3.2 Tool Lifecycle Hooks
**Goal:** Add hooks for monitoring and metrics

**Proposed:**
```csharp
public interface IToolLifecycleHook
{
    Task OnToolInvoked(string toolName, JsonRpcMessage request);
    Task OnToolCompleted(string toolName, JsonRpcMessage response, TimeSpan duration);
    Task OnToolFailed(string toolName, Exception error);
}

// Register in DI
builder.Services.AddSingleton<IToolLifecycleHook, MetricsHook>();
```

**Benefits:**
- Easy integration with metrics systems (Prometheus, Application Insights)
- Audit trail for tool invocations
- Performance monitoring

**Estimated effort:** 12-16 hours (design + implement + test)  
**Priority:** MEDIUM (useful for production monitoring)

---

#### 3.3 Custom Transport Providers
**Goal:** Pluggable transport system for custom protocols

**Proposed:**
```csharp
public interface ITransportProvider
{
    Task<JsonRpcMessage> ReceiveAsync(CancellationToken ct);
    Task SendAsync(JsonRpcMessage message, CancellationToken ct);
}

// Custom transport
public class GrpcTransportProvider : ITransportProvider { ... }

// Register
builder.AddToolsService()
    .WithTransport<GrpcTransportProvider>();
```

**Benefits:**
- Support for gRPC, SignalR, custom protocols
- Extensibility without modifying core library
- Community can add transports

**Trade-offs:**
- Significant architecture changes
- May not be needed (current transports cover most use cases)

**Estimated effort:** 30-40 hours (design + implement + test)  
**Priority:** LOW (no clear demand yet)

---

#### 3.4 Enhanced Streaming
**Goal:** Add compression, flow control, and multiplexing to streaming

**Ideas:**
- Compression: gzip/brotli for text streams
- Flow control: Backpressure handling
- Multiplexing: Multiple streams per connection

**Benefits:**
- Better bandwidth utilization
- Support for slow clients
- More efficient connection usage

**Trade-offs:**
- Complexity
- May break compatibility with existing clients

**Estimated effort:** 40-60 hours (major feature)  
**Priority:** LOW (current streaming works well)

---

### Category 4: Quality of Life

#### 4.1 Better Error Messages
**Goal:** More descriptive error messages for common mistakes

**Examples:**
- Tool not found ‚Üí suggest similar tool names
- Invalid parameters ‚Üí show expected schema
- Session expired ‚Üí suggest re-initialization

**Estimated effort:** 4-8 hours (implement + test)  
**Priority:** MEDIUM (improves developer experience)

---

#### 4.2 Health Check Improvements
**Goal:** More detailed health checks for production monitoring

**Proposed:**
```json
{
  "status": "healthy",
  "uptime": "2h 15m",
  "tools": 42,
  "prompts": 5,
  "resources": 12,
  "sessions": 3,
  "notifications": {
    "sseStreams": 3,
    "wsConnections": 0
  },
  "version": "1.8.0",
  "protocolVersion": "2025-11-25"
}
```

**Estimated effort:** 4-6 hours (implement + test)  
**Priority:** LOW (current health check is adequate)

---

#### 4.3 Example Updates
**Goal:** Update examples to showcase v1.7.0 features

**Tasks:**
- Update all examples to use `/mcp` endpoint
- Add session management examples
- Add SSE notification examples
- Update documentation with v1.7.0 patterns

**Estimated effort:** 6-8 hours (update + test + docs)  
**Priority:** HIGH (should be done soon after v1.7.0)

---

## üìä Prioritization Framework

### Must-Have (v1.8.0)
- ‚úÖ Example updates (HIGH priority)
- ‚úÖ Better error messages (MEDIUM priority)

### Should-Have (v1.8.0 or v1.9.0)
- Tool lifecycle hooks (monitoring)
- Resource subscriptions (optional MCP feature)

### Nice-to-Have (v2.0+)
- Resource templates
- Completion API
- Logging support
- ~~Hybrid Tool API~~ (NOT NEEDED - `TypedJsonRpc<T>.Inner` already exists!)
- Performance optimizations (only if bottlenecks confirmed)

### Future Consideration
- Custom transport providers
- Enhanced streaming
- Connection pooling

---

## üéØ Proposed v1.8.0 Scope

**Goal:** Small, focused release with high-value improvements

**Included:**
1. ‚úÖ Update all examples to v1.7.0 patterns (6-8h)
2. ‚úÖ Better error messages (4-8h)
3. ‚úÖ Tool lifecycle hooks for monitoring (12-16h)
4. ‚úÖ Resource subscriptions (8-12h)

**Total estimated:** ~30-44 hours (~1 week of focused work)

**Excluded (defer to v1.9.0 or v2.0):**
- Resource templates (needs more design)
- Completion API (low demand)
- Logging support (can wait)
- Performance optimizations (no confirmed bottlenecks)
- ~~Hybrid Tool API~~ (NOT NEEDED - `TypedJsonRpc<T>.Inner` already exists!)
- Custom transports (no clear use case yet)

---

## üöÄ Implementation Strategy

### Phase 1: Examples & Documentation (Quick Wins)
**Goal:** Showcase v1.7.0 features, help users migrate

**Tasks:**
1. Update `Examples/CalculatorMcpServer` to use `/mcp` endpoint
2. Update `Examples/DateTimeMcpServer` to use `/mcp` endpoint
3. Update `Examples/PromptMcpServer` to use `/mcp` endpoint
4. Update `Examples/ResourceMcpServer` to use `/mcp` endpoint
5. Update `Examples/NotificationMcpServer` to show SSE notifications
6. Add session management example
7. Update documentation with migration guide

**Estimated time:** 6-8 hours  
**Priority:** HIGH  
**Can start:** Immediately

---

### Phase 2: Error Messages (Quality of Life)
**Goal:** Better DX with descriptive errors

**Tasks:**
1. Tool not found ‚Üí suggest similar names (Levenshtein distance)
2. Invalid params ‚Üí show expected schema with examples
3. Session expired ‚Üí clear re-initialization guidance
4. Protocol version mismatch ‚Üí show supported versions

**Estimated time:** 4-8 hours  
**Priority:** MEDIUM  
**Can start:** After Phase 1

---

### Phase 3: Tool Lifecycle Hooks (Monitoring)
**Goal:** Production-ready monitoring and metrics

**Tasks:**
1. Design `IToolLifecycleHook` interface
2. Implement hook invocation in `ToolInvoker`
3. Add metrics example (Prometheus/Application Insights)
4. Write tests
5. Update documentation

**Estimated time:** 12-16 hours  
**Priority:** MEDIUM  
**Can start:** After Phase 2

---

### Phase 4: Resource Subscriptions (Optional MCP)
**Goal:** Implement optional MCP 2025-11-25 feature

**Tasks:**
1. Design subscription storage (per-session)
2. Implement `resources/subscribe` handler
3. Implement `resources/unsubscribe` handler
4. Update notification logic to check subscriptions
5. Add tests
6. Update documentation

**Estimated time:** 8-12 hours  
**Priority:** MEDIUM  
**Can start:** After Phase 3

---

## üìä Timeline Estimate

| Phase | Duration | Deliverables | Status |
|-------|----------|--------------|--------|
| **Phase 1** | 6-8 hours | Updated examples + docs | ‚úÖ **COMPLETE** (15 min) |
| **Phase 2** | 4-8 hours | Better error messages | ‚úÖ **COMPLETE** (1 hour) |
| **Phase 3 (Tasks 1-4)** | 8-10 hours | Lifecycle hooks (infra + integration) | ‚úÖ **COMPLETE** (4 hours) |
| **Phase 3 (Tasks 5-7)** | 4-6 hours | DI + Example + Docs | ‚è≥ **TODO** |
| **Phase 4** | 8-12 hours | Resource subscriptions | üìù Planned |
| **Total** | **30-44 hours** | v1.8.0 Release | üöß **In Progress** (Phase 1-2 done, Phase 3 50% done) |

**Target:** ~1 week of focused work (not consecutive)

**Progress summary (19. desember 2025):**
- ‚úÖ Phase 1: 15 minutes (estimated 6-8 hours)
- ‚úÖ Phase 2: 1 hour (estimated 4-8 hours)
- ‚úÖ Phase 3 (Tasks 1-4): 4 hours (estimated 8-10 hours)
- ‚è≥ Phase 3 (Tasks 5-7): TODO (estimated 4-6 hours)
- ‚è≥ Phase 4: TODO (estimated 8-12 hours)

**Total actual time so far:** ~5.25 hours  
**Total remaining:** ~12-18 hours

---

## ‚úÖ Completed Phases (19. desember 2025)

### Phase 1: Examples & Documentation ‚úÖ (DONE!)

**Actual time:** ~15 minutes (much faster than estimated!)

**Deliverables:**
1. ‚úÖ All examples already use `/mcp` endpoint (no changes needed!)
2. ‚úÖ `Examples/NotificationMcpServer/SESSION_MANAGEMENT.md` - Comprehensive session management guide
3. ‚úÖ `MIGRATION_GUIDE_v1.7.0.md` - Migration guide from v1.6.x to v1.7.0

**Why so fast?**
- All examples were already updated to v1.7.0 patterns during v1.7.0 development
- Only needed to add documentation guides

**Commits:**
- `docs(v1.8.0): Phase 1 complete - add session management and migration guides`

---

### Phase 2: Better Error Messages ‚úÖ (DONE!)

**Actual time:** ~1 hour

**Deliverables:**
1. ‚úÖ **Tool not found ‚Üí suggest similar names**
   - `Mcp.Gateway.Tools/StringSimilarity.cs` - Levenshtein distance calculator
   - Suggests up to 3 similar tool names (max edit distance: 3)
   - Example: `add_number` ‚Üí suggests `["add_numbers", "add_numbers_typed"]`

2. ‚úÖ **Invalid params ‚Üí show expected schema**
   - Enhanced `ToolInvalidParamsException` with `ToolName` property
   - Extracts required fields from schema
   - Builds example JSON with all required parameters
   - Example: Shows `{ "number1": 42, "number2": 42 }` for `add_numbers`

3. ‚úÖ **Session expired ‚Üí clear re-initialization guidance**
   - Added `SessionExpiredException` class
   - Session expiry handling already implemented in v1.7.0
   - Clear guidance: "Please re-initialize with POST /mcp"

4. ‚úÖ **Protocol version mismatch** (already done in v1.7.0!)
   - Shows supported versions: `["2025-11-25", "2025-06-18", "2025-03-26"]`
   - Returns 400 Bad Request with helpful error

**Example improved error (Tool not found):**
```json
{
  "error": {
    "code": -32601,
    "message": "Method not found",
    "data": {
      "detail": "Function 'add_number' is not configured.",
      "requestedTool": "add_number",
      "suggestions": ["add_numbers", "add_numbers_typed"],
      "hint": "Did you mean: add_numbers, add_numbers_typed?"
    }
  }
}
```

**Example improved error (Invalid params):**
```json
{
  "error": {
    "code": -32602,
    "message": "Invalid params",
    "data": {
      "detail": "Parameters 'number1' and 'number2' are required",
      "tool": "add_numbers",
      "requiredFields": ["number1", "number2"],
      "example": "{ \"number1\": 42, \"number2\": 42 }",
      "hint": "Required fields: number1, number2"
    }
  }
}
```

**Commits:**
- `feat(v1.8.0): Phase 2 Task 1 - suggest similar tool names when tool not found`
- `feat(v1.8.0): Phase 2 Task 2 - show expected schema on invalid params`
- `feat(v1.8.0): Phase 2 Task 3 - add SessionExpiredException for better error guidance`

**Files changed:**
- `Mcp.Gateway.Tools/StringSimilarity.cs` (new)
- `Mcp.Gateway.Tools/ToolExceptions.cs` (enhanced)
- `Mcp.Gateway.Tools/ToolInvoker.Protocol.cs` (enhanced)

---

### Phase 3: Tool Lifecycle Hooks üöß (IN PROGRESS!)

**Estimated time:** 12-16 hours  
**Actual time so far:** ~4 hours  
**Started:** 19. desember 2025, kl. 15:44  
**Latest update:** 19. desember 2025, kl. 16:15

**Progress:**
1. ‚úÖ **Design `IToolLifecycleHook` interface** (DONE!)
   - `Mcp.Gateway.Tools/Lifecycle/IToolLifecycleHook.cs`
   - Three lifecycle events: `OnToolInvokingAsync`, `OnToolCompletedAsync`, `OnToolFailedAsync`
   - Fire-and-forget pattern (hooks should not throw)

2. ‚úÖ **Built-in implementations** (DONE!)
   - `LoggingToolLifecycleHook` - Simple logging to ILogger
   - `MetricsToolLifecycleHook` - In-memory metrics (invocation count, success rate, duration)
   - `ToolMetrics` class - Metrics per tool (thread-safe)

3. ‚úÖ **Integration with ToolInvoker** (DONE!)
   - Updated `ToolInvoker.cs` constructor to accept `IEnumerable<IToolLifecycleHook>`
   - Added `InvokeLifecycleHooksAsync` helper (fire-and-forget)
   - Added `InvokeToolWithHooksAsync` wrapper (OnInvoking ‚Üí Invoke ‚Üí OnCompleted/OnFailed)

4. ‚úÖ **Hook invocation in tool execution** (DONE!)
   - Integrated hooks into `InvokeSingleAsync` (direct tool calls)
   - Integrated hooks into `HandleFunctionsCallAsync` (tools/call path)
   - Smart filtering: Only user-defined tools tracked (not MCP protocol methods)
   - Proper unwrapping of results in all paths
   - **All 254 tests passing!** ‚úÖ

5. ‚è≥ **DI registration** (TODO)
   - Update `ToolExtensions.cs` to register hooks
   - Make hooks optional (backward compatible)

6. ‚è≥ **Example usage** (TODO)
   - Add example MCP server with metrics endpoint
   - Show Prometheus/Application Insights integration pattern

7. ‚è≥ **Tests** (TODO)
   - Unit tests for hook implementations
   - Integration tests for hook invocation

8. ‚è≥ **Documentation** (TODO)
   - README section on lifecycle hooks
   - Example code snippets

**Commits:**
- `feat(v1.8.0): Phase 3 Tasks 1-3 - tool lifecycle hooks infrastructure`
- `feat(v1.8.0): Phase 3 Task 4 - integrate lifecycle hooks in tool execution`

**Files created/changed:**
- `Mcp.Gateway.Tools/Lifecycle/IToolLifecycleHook.cs` (new)
- `Mcp.Gateway.Tools/Lifecycle/LoggingToolLifecycleHook.cs` (new)
- `Mcp.Gateway.Tools/Lifecycle/MetricsToolLifecycleHook.cs` (new)
- `Mcp.Gateway.Tools/ToolInvoker.cs` (enhanced)
- `Mcp.Gateway.Tools/ToolInvoker.Protocol.cs` (enhanced)

**Test results:**
- ‚úÖ All 254 tests passing!
- ‚úÖ Zero breaking changes
- ‚úÖ Backward compatible (hooks optional)

**Next steps:**
1. DI registration (Task 5) - ~1 hour
2. Example + tests (Task 6) - ~3-4 hours
3. Documentation (Task 7) - ~1-2 hours

**Status:** üöß **IN PROGRESS** (Tasks 1-4 complete, Tasks 5-7 remaining)

---

## üéñÔ∏è Success Criteria

### v1.8.0 Goals
- ‚úÖ All examples use v1.7.0 patterns (`/mcp` endpoint, SSE) - **DONE (Phase 1)**
- ‚úÖ Better error messages for common mistakes - **DONE (Phase 2)**
- ‚è≥ Tool lifecycle hooks for monitoring - **TODO (Phase 3)**
- ‚è≥ Resource subscriptions (optional MCP feature) - **TODO (Phase 4)**
- ‚úÖ All tests passing (253+ tests) - **VERIFIED**
- ‚úÖ Zero breaking changes - **VERIFIED**
- ‚úÖ Documentation updated - **DONE (Phase 1)**

### Completed (Phase 1-2)
- ‚úÖ Session management documentation (`SESSION_MANAGEMENT.md`)
- ‚úÖ Migration guide (`MIGRATION_GUIDE_v1.7.0.md`)
- ‚úÖ Tool not found suggestions (Levenshtein distance)
- ‚úÖ Invalid params schema hints
- ‚úÖ Session expired error improvements
- ‚úÖ Protocol version validation (v1.7.0 feature)

### Remaining (Phase 3-4)
- ‚è≥ Tool lifecycle hooks (12-16 hours)
- ‚è≥ Resource subscriptions (8-12 hours)

### Non-Goals (Deferred)
- ‚ùå Performance optimizations (no confirmed bottlenecks)
- ‚ùå Resource templates (needs more design)
- ‚ùå Completion API (low demand)
- ‚ùå Custom transport providers (no clear use case)
- ‚ùå Hybrid Tool API (NOT NEEDED - `TypedJsonRpc<T>.Inner` already provides raw JSON access!)

---
